Sub Group_By_Subtotals_Until_Investment_Total()

    Dim ws As Worksheet
    Set ws = ActiveSheet

    Dim LR As Long          ' Row of "Investment Total"
    Dim Ct As Long          ' Row of "Subtotal"
    Dim Cb As Long          ' Current block start
    Dim r As Long

    Application.ScreenUpdating = False
    Application.EnableEvents = False

    '--------------------------------------------------
    ' Find row containing "Investment Total" (LR)
    '--------------------------------------------------
    LR = 0
    For r = 1 To ws.Cells(ws.Rows.Count, "A").End(xlUp).Row
        If InStr(1, ws.Cells(r, "A").Value, "Investment Total", vbTextCompare) > 0 Then
            LR = r
            Exit For
        End If
    Next r

    If LR = 0 Then
        MsgBox "'Investment Total' not found in Column A.", vbExclamation
        GoTo CleanExit
    End If

    '--------------------------------------------------
    ' Initialize Cb and loop to group Subtotal blocks
    '--------------------------------------------------
    Cb = 7

    For r = Cb To LR

        If InStr(1, ws.Cells(r, "A").Value, "Subtotal", vbTextCompare) > 0 Then
            Ct = r

            If Ct > Cb Then
                ws.Rows(Cb & ":" & Ct - 1).Group
            End If

            Cb = Ct + 1
        End If

    Next r

    '--------------------------------------------------
    ' Collapse all outline groups
    '--------------------------------------------------
    ws.Outline.ShowLevels RowLevels:=1

CleanExit:
    Application.ScreenUpdating = True
    Application.EnableEvents = True

End Sub
