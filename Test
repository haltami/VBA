Sub FormatAndGroupSheet()

    Dim ws As Worksheet
    Dim lastRow As Long
    Dim Cb As Long
    Dim Ct As Long
    Dim i As Long

    Set ws = ActiveSheet

    ' Freeze panes at row 8
    ws.Activate
    ws.Range("A8").Select
    ActiveWindow.FreezePanes = True

    ' Determine last used row in column A
    lastRow = ws.Cells(ws.Rows.Count, "A").End(xlUp).Row

    ' Initialize markers
    Cb = 0
    Ct = 0

    ' Scan column A for target text
    For i = 1 To lastRow
        If Cb = 0 Then
            If InStr(1, ws.Cells(i, "A").Value, "(Balance forward", vbTextCompare) > 0 Then
                Cb = i
            End If
        End If

        If Ct = 0 Then
            If InStr(1, ws.Cells(i, "A").Value, "Totals for", vbTextCompare) > 0 Then
                Ct = i
            End If
        End If

        If Cb > 0 And Ct > 0 Then Exit For
    Next i

    ' Validate results before grouping
    If Cb = 0 Or Ct = 0 Then
        MsgBox "Required text not found in Column A.", vbExclamation
        Exit Sub
    End If

    If Ct - Cb <= 1 Then
        MsgBox "No rows available to group between Balance Forward and Totals.", vbExclamation
        Exit Sub
    End If

    ' Clear existing outlines (optional but recommended)
    ws.Rows.ClearOutline

    ' Group rows between markers
    ws.Rows((Cb + 1) & ":" & (Ct - 1)).Group

End Sub
