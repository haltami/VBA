Sub FormatAndGroupSheet()

    Dim ws As Worksheet
    Dim i As Long
    Dim lastRow As Long
    Dim Cb As Long
    Dim Ct As Long
    Dim searchStart As Long

    Set ws = ActiveSheet

    Application.ScreenUpdating = False
    Application.EnableEvents = False

    '-----------------------------------
    ' Freeze panes at row 8
    '-----------------------------------
    ws.Activate
    ws.Range("A8").Select
    ActiveWindow.FreezePanes = True

    '-----------------------------------
    ' Find last used row in Column A
    '-----------------------------------
    lastRow = ws.Cells(ws.Rows.Count, "A").End(xlUp).Row

    '-----------------------------------
    ' Loop Column A and group sections
    '-----------------------------------
    searchStart = 1

    Do While searchStart <= lastRow

        Cb = 0
        Ct = 0

        ' Find "(Balance forward"
        For i = searchStart To lastRow
            If InStr(1, ws.Cells(i, "A").Value, "(Balance forward", vbTextCompare) > 0 Then
                Cb = i
                Exit For
            End If
        Next i

        If Cb = 0 Then Exit Do

        ' Find "Totals for" after Balance forward
        For i = Cb + 1 To lastRow
            If InStr(1, ws.Cells(i, "A").Value, "Totals for", vbTextCompare) > 0 Then
                Ct = i
                Exit For
            End If
        Next i

        If Ct > Cb + 1 Then
            ws.Rows(Cb + 1 & ":" & Ct - 1).Group
        End If

        searchStart = Ct + 1

    Loop

    '-----------------------------------
    ' Collapse all outline groups
    '-----------------------------------
    ws.Outline.ShowLevels RowLevels:=1

    '-----------------------------------
    ' Apply comma style to columns
    '-----------------------------------
    ws.Columns("I:I").NumberFormat = "#,##0.00"
    ws.Columns("J:J").NumberFormat = "#,##0.00"
    ws.Columns("K:K").NumberFormat = "#,##0.00"
    ws.Columns("O:O").NumberFormat = "#,##0.00"

    '-----------------------------------
    ' Apply fill color to M1:M(LR)
    '-----------------------------------
    ws.Range("M1:M" & lastRow).Interior.Color = -0.0999786370433668

    Application.ScreenUpdating = True
    Application.EnableEvents = True

End Sub
