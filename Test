'--------------------------------------------------
' Find row containing "Investment Total" (LR)
'--------------------------------------------------
Dim LR As Long
Dim r As Long
Dim Cb As Long
Dim Ct As Long

LR = 0

For r = 1 To ws.Cells(ws.Rows.Count, "A").End(xlUp).Row
    If InStr(1, ws.Cells(r, "A").Value, "Investment Total", vbTextCompare) > 0 Then
        LR = r
        Exit For
    End If
Next r

If LR = 0 Then Exit Sub   ' Safety exit if text not found

'--------------------------------------------------
' Group rows between Subtotals
' Starting CB = 7
'--------------------------------------------------
Cb = 7

For r = Cb To LR

    If InStr(1, ws.Cells(r, "A").Value, "Subtotal", vbTextCompare) > 0 Then
        Ct = r

        If Ct > Cb Then
            ws.Rows(Cb & ":" & (Ct - 1)).Group
        End If

        Cb = Ct + 1
    End If

Next r

'--------------------------------------------------
' Collapse all outline groups
'--------------------------------------------------
ws.Outline.ShowLevels RowLevels:=1
